<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Sepolia çŒœæ•¸å­—éŠæˆ²</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body style="font-family: Arial; padding: 20px;">
  <h1>ğŸ² Sepolia çŒœæ•¸å­—éŠæˆ²</h1>
  <p>éŠæˆ²è¦å‰‡ï¼šæ¯æ¬¡çŒœé¡Œéœ€æ”¯ä»˜ <b>0.001 ETH</b>ï¼Œç­”æ¡ˆç¯„åœ <b>0 - 10000</b>ã€‚</p>

  <!-- é€£æ¥ MetaMask -->
  <button onclick="connectWallet()">ğŸ”— é€£æ¥éŒ¢åŒ…</button>
  <p id="wallet">å°šæœªé€£æ¥</p>

  <label for="guessInput">è«‹è¼¸å…¥ä½ çš„æ•¸å­—ï¼š</label>
  <input type="number" id="guessInput" min="0" max="10000">
  <button onclick="guessNumber()">æäº¤çŒœæ¸¬</button>

  <h3>ğŸ’° çæ± ç‹€æ…‹</h3>
  <button onclick="getPool()">æŸ¥çœ‹çæ± é¤˜é¡</button>
  <p id="pool">--</p>

  <h3>ğŸ“¢ ç‹€æ…‹</h3>
  <pre id="status"></pre>

  <script>
    // âš ï¸ éƒ¨ç½²åˆç´„å¾Œï¼ŒæŠŠé€™è£¡æ›æˆä½ çš„åˆç´„åœ°å€
    const contractAddress = "0x9b831a6cfea951b9d575c73a0c7737e0a0f47823";

    const contractABI = [
      "function guess(uint16 _guess) external payable",
      "function getBalance() external view returns (uint256)"
    ];

    let provider, signer, contract;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("âŒ è«‹å…ˆå®‰è£ MetaMask");
        return;
      }
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const addr = await signer.getAddress();
        document.getElementById("wallet").innerText = "âœ… å·²é€£æ¥: " + addr;
        contract = new ethers.Contract(contractAddress, contractABI, signer);
      } catch (err) {
        console.error(err);
        document.getElementById("wallet").innerText = "âš ï¸ é€£ç·šå¤±æ•—";
      }
    }

    async function guessNumber() {
      try {
        if (!contract) {
          alert("è«‹å…ˆé€£æ¥éŒ¢åŒ…");
          return;
        }
        const num = document.getElementById("guessInput").value;
        if (!num) {
          alert("è«‹è¼¸å…¥æ•¸å­—");
          return;
        }
        const tx = await contract.guess(num, {
          value: ethers.utils.parseEther("0.001")
        });
        document.getElementById("status").innerText = "â³ äº¤æ˜“é€å‡ºä¸­: " + tx.hash;
        await tx.wait();
        document.getElementById("status").innerText = "ğŸ‰ äº¤æ˜“å®Œæˆ: " + tx.hash;
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âš ï¸ éŒ¯èª¤: " + err.message;
      }
    }

    async function getPool() {
      try {
        if (!contract) {
          alert("è«‹å…ˆé€£æ¥éŒ¢åŒ…");
          return;
        }
        const balance = await contract.getBalance();
        const ethBal = ethers.utils.formatEther(balance);
        document.getElementById("pool").innerText = `ç›®å‰çæ± : ${ethBal} ETH`;
      } catch (err) {
        console.error(err);
        document.getElementById("pool").innerText = "âš ï¸ ç„¡æ³•è®€å–çæ± ";
      }
    }
  </script>
</body>
</html>
